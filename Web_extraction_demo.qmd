---
title: "Web Extraction"
format: html
author: "Nathan Weldon"
date: as.date()
editor: visual
---

## Introduction

In this project, I will work with online sources to recreate already produced data as a challenge. I will demonstrate my ability in data extraction, cleaning, and visualization.

```{r}
pacman::p_load(
  tidyverse,
  fivethirtyeight,
  rvest,
  httr,
  janitor
)

```

## Movie Data

538 is a website that focuses on opinion poll analysis, politics, economics, and sports blogging. It was created and is currently run by Nate Silver, who has become famous for his writing and work on the site. I found this interesting article [linked here](https://fivethirtyeight.com/features/fandango-movies-ratings/) about how fandango has unnecessary rounded ratings when rating movies. Below is the recreation of that plot and more conclusions.

```{r warning = FALSE, echo = FALSE, include = FALSE}
# install.packages("fivethirtyeight")
rating <- read.csv('https://raw.githubusercontent.com/fivethirtyeight/data/master/fandango/fandango_score_comparison.csv') 

```

```{r}
#Finding Fandango Stars
fandango <- rating %>%
  drop_na() %>% 
  filter(Fandango_votes > 30) %>% 
  filter(FILM %>% str_detect('2015')) %>% 
  select(c(FILM, Fandango_Stars)) 

count_fandango <- count(fandango, Fandango_Stars)

tibble <- tibble(Fandango_Stars = seq(0,5, .5),
                 n = 0)

fandango_data <- full_join(tibble, count_fandango)

fandango_plot <- ggplot(data = fandango_data, aes(x = Fandango_Stars, y = n)) +
  geom_line(color = 'red') +
  geom_area(fill = 'tomato', alpha = .5)

fandango_plot
```

```{r include = FALSE}

#Finding Other Stars
other <- rating %>% 
  drop_na() %>% 
  filter(Fandango_votes > 30) %>% 
  filter(FILM %>% str_detect('2015')) %>% 
  mutate(RT = round(RT_norm, digits = 1)) %>%
  mutate(RT_user = round(RT_user_norm, digits = 1)) %>% 
  mutate(Metacritic = round(Metacritic_norm, 1)) %>%
  mutate(Metacritic_user = round(Metacritic_user_nom, 1)) %>% 
  mutate(IMDB_user = round(IMDB_norm, 1)) %>% 
  select(c(FILM, RT, RT_user, Metacritic, Metacritic_user, IMDB_user)) 

#Rotten Tomatoes
count_rt <- count(other, RT)

rt_tibble <- tibble(RT = seq(0,5,.1),
                    n = 0)
rt_data <- full_join(rt_tibble, count_rt)

#RT User
count_rt_user <- count(other, RT_user)
rt_user_tibble <- tibble(RT = seq(0,5,.1),
                         n = 0)
rt_user_data <- full_join(rt_user_tibble, count_rt_user)
#Metacritic
count_mc <- count(other, Metacritic) %>% 
  slice(-c(1))

mc_tibble1 <- tibble(Metacritic = seq(4.8,5,.1),
                     n = 0)
mc_tibble <- tibble(Metacritic = seq(0,1,.1),
                     n = 0)
mc_data1 <- rbind(count_mc, mc_tibble1)
mc_data <- rbind(mc_tibble, mc_data1)

#IMDB
count_imdb <- count(other, IMDB)

imdb_tibble2 <- tibble(IMDB = seq(0,1.9,.1),
                       n = 0)
imdb_tibble1 <- tibble(IMDB = 2.4,
                       n = 0)
imdb_tibble <- tibble(IMDB = seq(4.4,5,.1),
                     n = 0) 

imdb_data2 <- rbind(count_imdb, imdb_tibble2)
imdb_data1 <- rbind(imdb_data2,imdb_tibble1)
imdb_data <- rbind(imdb_data1, imdb_tibble) 
```

```{r}
#Plot
plot <- ggplot(data = fandango_data, aes(Fandango_Stars, n)) +
  geom_line(color = 'red') +
  geom_area(fill = 'tomato', alpha = .5) +
  scale_x_continuous(limits = c(0,5.1), 
                     breaks = seq(0,5,1)) +
  scale_y_continuous(limits = c(0,90), 
                     labels = scales::percent_format(scale = .5, 
                                                     accuracy = 10)) +
  labs(title = "Fandango.com's Ratings Are Inflated By Rounding",
       subtitle = "Ratings distribution of 209 films that played in theaters in 2015 and received 30+ reviews",
       y = " ",
       x = " ") +
  theme(panel.background = element_rect(fill = '#F5F5F5')) +
  theme(plot.background = element_rect(fill = '#F5F5F5')) +
  theme(plot.title = element_text(size = 20, face = 'bold', color = 'grey20')) +
  theme(plot.subtitle = element_text(size = 13, color = 'grey25'))

plot
```

### Conclusion

## HTML

Description

```{r warning = FALSE}
ds <-read_html('https://en.wikipedia.org/wiki/Educational_attainment_in_the_United_States') %>%
  html_elements('table.sortable') %>%
  html_table()

table <- ds[[2]] %>%
  drop_na() %>%
  clean_names() %>%
  pivot_longer(!year, names_to = 'Age', values_to ='Median_income') %>%
  mutate(Median_income = str_sub(Median_income, start = 2)) %>%
  filter(Median_income %>% str_detect(",")) %>%
  slice(-c(159:176))

tablescrub2 <- tablescrub$Age %>%
  str_replace_all('_',' ') %>%
  str_to_title() %>%
  fct_relevel(c("Less Than 9th Grade",
                "High School Drop Out",
                "High School Graduate",
                "Some College",
                "Associate Degree",
                "Bachelors Degree",
                "Bachelors Degree Or More",
                "Masters Degree",
                "Doctorate Degree",
                "Professional Degree",
                "Overall Median"))

tablescrub3 <- tablescrub$Median_income %>%
  str_remove(',') %>%
  as.numeric(tablescrub$Median_income)

thetable<- tablescrub %>%
  mutate(Level = tablescrub2) %>%
  mutate(Income = tablescrub3) %>%
  select(1,4,5)

plot <- ggplot(data = thetable, mapping = aes(x = year, y = Income, color = Level, group = Level)) +
  geom_line() +
  labs(x = 'Year',
       y = 'Median Income') +
  scale_y_continuous(limits = c(20000,160000)) +
  theme_bw()
theplot
```
